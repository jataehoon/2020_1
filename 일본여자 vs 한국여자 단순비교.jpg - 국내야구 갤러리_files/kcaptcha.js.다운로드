var kcaptcha_init = function(no) {
	if (typeof(KCAPTCHA_JS) == 'undefined') {
		var KCAPTCHA_JS = true;
		var md5_norobot_key = '';
		var gall_id = $('#id').val();
		var csrf_token = get_cookie('ci_c');
		
		$('.kcaptcha').unbind('click');
		$('.kcaptcha').bind('click', function(e) {
			/*var evt = e || window.event;
		    if(evt.stopPropagation) {
		        evt.stopPropagation();  // W3C 표준
		    }
		    else { 
		        evt.cancelBubble = true; // 인터넷 익스플로러 방식
		    }*/
			var kcaptcha_id = this.id;
			var kcaptcha_type = $(this).attr('data-type');
			if(kcaptcha_type == "" || typeof no == 'undefined') kcaptcha_type = "write";
			
			var gall_id = $('#id').val();
			var csrf_token = get_cookie('ci_c');

			$.post('/kcaptcha/session', { ci_t : csrf_token, 'gall_id' : gall_id, kcaptcha_type : kcaptcha_type, _GALLTYPE_ : _GALLERY_TYPE_ }, function(data) {
				$("#"+kcaptcha_id).attr('src','/kcaptcha/image/?gall_id='+ gall_id +'&kcaptcha_type='+ kcaptcha_type +'&time='+ (new Date).getTime() + '&_GALLTYPE_=' + _GALLERY_TYPE_);
			});
		});
		
		//개념 추천
		var recommend_kcaptcha_id = "kcaptcha_recommend";
		var recommend_code_use_id = "recommend_code_use_yn";
		
		if(no != "" && typeof no != 'undefined'){
			recommend_kcaptcha_id += "_"+no;
			recommend_code_use_id += "_"+no;
		}
		
		//개념 추천 캡챠
		if($('#'+recommend_code_use_id).val() == 'Y') {
			$('#'+recommend_kcaptcha_id).trigger('click');
            /*setTimeout(function() {
            	//console.log('recommend_kcaptcha');
                $('#'+recommend_kcaptcha_id).trigger('click');
            }, 2000);*/
        }
		
		//댓글 캡챠
		var kcaptcha_id = "kcaptcha";
		kcaptcha_id += (no != "" && typeof no != 'undefined')?"_"+no:"";
		setTimeout(function() {
			//console.log('comment_kcaptcha');
            $('#'+kcaptcha_id).trigger('click');
        }, 100);
		
		if (typeof $.validator != 'undefined') {
			$.validator.addMethod('capcha_code', function(value, element) {
				return this.optional(element) || hex_md5(value) == md5_norobot_key;
			});
		}
	}
};
