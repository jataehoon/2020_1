/*
 * 즐겨찾기 스크립트
 * 2018.02.05 - jhcho
 * 
 */

// 즐겨찾기 열기/닫기
var myFavorite = function() {
    if($('#my_favorite').css('display') == 'none') {
    	$('#my_favorite .list_box li').remove();
    	
    	$.ajax({
			url: "/ajax/favorite_ajax/my_list",
			type: "GET",
			cache: false,
		    async: true,
			success: function(ajaxData) {
				var data = $.parseJSON(ajaxData);
				
				if(data && data.length > 0) {
					$('#favorite-tmpl').tmpl(data).prependTo('#my_favorite .list_box');
				}
				else {
					$('#my_favorite .list_box').hide();
					$('#my_favorite .empty_box').show();
				}
		        
				login_box_layer_close();
		    	$('#my_favorite').show();
		    	$('.user_option .icon_favorites').removeClass('hide');
			}
		});
    }
    else {
    	myFavoriteClose();
    	$('.user_option .icon_favorites').addClass('hide');
    }
};

//즐겨찾기 아이템 on/off
var myFavoriteToggle = function(elm) {
	if($(elm).hasClass('off'))	$(elm).removeClass('off');
	else						$(elm).addClass('off');
};

//즐겨찾기 개별 추가/삭제
var myFavoriteInsDel = function(gall_id, type) {
	if($('.favorite button').hasClass('on')) {
		var status = 0;
		$('.favorite button').removeClass('on');
	}
	else {
		var status = 1;
		$('.favorite button').addClass('on');
	}
	
	var item = [{ type: type, code_id: gall_id, status: status }];
	
	favoriteUpdate(item);
};

//즐겨찾기 삭제
var myFavoriteDelete = function() {
	var items = new Array();
	
	$('#my_favorite .btn_sfavorite').each(function() {
		if($(this).hasClass('off')) {
			var type = $(this).attr('data-type') == 'MI' ? $(this).attr('data-type') : 'G';  
			items.push({ type: type, code_id: $(this).attr('data-id'), status: 0 });
		}
	});
	
	res = favoriteUpdate(items, true);

};

//즐겨찾기 수정 저장
var favoriteUpdate = function(items, show_alert) {
	var csrf_token = get_cookie('ci_c');
	
	if(items.length > 0) {
		$.ajax({
			url: "/ajax/favorite_ajax/my_update",
			type: "POST",
			cache: false,
		    async: true,
	        data: {
	            ci_t : csrf_token,
	            items : items
	        },
			success: function(res) {
				if(show_alert) {
					if(res != '0000') {
						alert('일시적인 오류로 저장되지 않았습니다.');
					}
				}
			}
		});
	}

	if(show_alert) {
		alert('저장되었습니다.');
		myFavoriteClose();
	}
}

// 즐겨찾기 레이어 닫기
var myFavoriteClose = function() {
	$('#my_favorite').hide();
};
