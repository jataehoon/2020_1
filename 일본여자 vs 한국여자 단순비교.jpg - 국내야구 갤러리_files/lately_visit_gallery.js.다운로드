function lately_gall_init(id, name, type) {
	var visit_elm = $('#visit_history');
	var segment = window.location.pathname.split('/');
		
	var newvisit_width = 0;
	var visit_left = 0;
	
	var visitStorageOptions = {
		    origin: "https://gall.dcinside.com",
		    path: "/_js/crossDomainStorage.html",
		    storage: "localStorage"
		};
	
	var Storage = new crossDomainStorage(visitStorageOptions);
	
	// 방문 쿠키 삭제
	var lately_gall_delete = function (elm) {
		var id = $(elm).attr('data-id');
		var gall_type = $(elm).attr('data-gtype');
		var eq = $(elm).parent().index();
		
		$('.visit_' + id).remove();
		
		Storage.getItem('lately_gallery', function(key, value) {
			
			strg_galls = modify_storage_json(value, id, gall_type);
			Storage.setItem('lately_gallery', JSON.stringify(strg_galls));
			if(strg_galls.length <= 0) {
				$('.empty_visit').show();
			}
		});
	}
	
	var modify_storage_json = function (jsonData, id, type) {
		
		var new_data = new Array();
		var strg_galls = $.parseJSON(jsonData);
		
		for(var i in strg_galls) {
			if(strg_galls[i] && typeof(strg_galls[i].id) != 'undefined' && (strg_galls[i].id != id || strg_galls[i].type != type)) {
				new_data.push(strg_galls[i]);
			}
		}
		return new_data;
	}
	
	Storage.getItem('lately_gallery', function(key, value) {
		try {
			var strg_galls = $.parseJSON(value);
		}
		catch(e) {
			var strg_galls = null;
			Storage.setItem('lately_gallery', strg_galls);
		}
		
		if(id) {
			if(strg_galls == null || typeof(strg_galls) != 'object' || typeof(strg_galls[0]) != 'object' || strg_galls[0].id != id || strg_galls[0].type != type) {
				strg_galls = modify_storage_json(value, id, type);
				
				var type_dir = '';
				if(type == 'M') {
					type_dir = 'mgallery/';
				} else if(type == 'MI') {
					type_dir = 'mini/'
				} else {
					type_dir = '';
				}
				
				link = 'gall.dcinside.com/'+ type_dir +'board/lists?id='+ id;
				
				strg_galls.unshift({ 'id' : id, 'name': name, 'type' : type, 'link' : link});
				Storage.setItem('lately_gallery', JSON.stringify(strg_galls.slice(0, 50)));
			}
		}
		
		if(strg_galls && strg_galls.length > 50) {
			strg_galls = strg_galls.slice(0, 50);
		}
		
		if(strg_galls && strg_galls.length > 0) {
			$('#lately_galls-tmpl').tmpl(strg_galls).appendTo('#visit_history .newvisit_list');
			$('#lately_gallsall-tmpl').tmpl(strg_galls).appendTo('#visit_history .under_listbox');
		}
		else {
			$('#visit_history .empty_visit').show();
		}
		
		// 삭제
		$('.btn_visit_del', visit_elm).click(function() {
			lately_gall_delete(this);
		});
		
		// 전체삭제 
		$('.list_alldel', visit_elm).click(function() {
			if(confirm('최근 방문 갤러리 목록을 모두 삭제하시겠습니까?')) {
				Storage.removeItem('lately_gallery');
				$('.newvisit_list li').remove();
				$('#newvisit_list_all li').remove();
				$('.empty_visit').show();
			}
			
		});
		
		var newvisit_width = $('.newvisit_list').get(0).scrollWidth;
		var newvisit_left_basic = $('.newvisit_list').get(0).offsetLeft;
		var scroll_width = $('.newvisit_list').get(0).offsetWidth;
		var last_scroll = (newvisit_width - scroll_width) * -1 ;				// 마지막칸
		
		
		$(".newvisit_list").draggable({
			 cursor:"pointer", // 커서 모양
//			 containment:"div", // div영역 에서만 움직이도록 설정
			 axis:"x", // 드래그 방향 설정 (x, y) 모두 움직이려면 axis 제거

			drag: function(event, ui){ 
				var left = ui.position.left;
				var offsetWidth = ($(this).width() - $(this).parent().width()) * -1;

				if(left > 0){ 
				  ui.position.left = 0;
				  $(".bnt_visit_prev").removeClass('on');
				  
				}
				if(left < newvisit_width * -1 ) {
					ui.position.left = newvisit_width * -1;
				}

				visit_left = ui.position.left;
				if(last_scroll > visit_left) {
					ui.position.left = last_scroll;
					visit_left = last_scroll;
					$(".bnt_visit_next").removeClass('on');
				} else {
					$(".bnt_visit_next").addClass('on');
				}
				
				if(ui.position.left < 0) $(".bnt_visit_prev").addClass('on');
			}

		});
		var scroll_move = scroll_width - 80;		
		if(newvisit_width > scroll_width) $(".bnt_visit_next").addClass('on');
		
		$('#visit_history .bnt_visit_prev').click(function(event){
			if(newvisit_width <= scroll_width)  return false;
			newvisit_left = $('.newvisit_list').get(0).offsetLeft - newvisit_left_basic;
			visit_left = newvisit_left + scroll_move;
			if(visit_left > 0) {
				visit_left = 0;
			}			
			$(".newvisit_list").animate({left: visit_left}, 600);
			
			if(visit_left == 0) {
				$(".bnt_visit_prev").removeClass('on');
			}
			$(".bnt_visit_next").addClass('on');

		});
		
		$('#visit_history .bnt_visit_next').click(function(event){
			if(newvisit_width <= scroll_width)  return false;		
			newvisit_left = $('.newvisit_list').get(0).offsetLeft - newvisit_left_basic;
			if(newvisit_left < (newvisit_width - scroll_move) * -1) {
				return false;
			}
			visit_left = newvisit_left - scroll_move;
			if(last_scroll > visit_left) {
				visit_left = last_scroll;
				$(".bnt_visit_next").removeClass('on');
			}
			$(".newvisit_list").animate({left: visit_left}, 600);
			
			$(".bnt_visit_prev").addClass('on');
		});

		
		
	});
}
